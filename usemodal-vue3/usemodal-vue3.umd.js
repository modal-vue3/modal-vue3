(function(s,l){typeof exports=="object"&&typeof module<"u"?l(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],l):(s=typeof globalThis<"u"?globalThis:s||self,l(s["usemodal-vue3"]={},s.Vue))})(this,function(s,l){"use strict";function M(e){const h=l.reactive({}),d={currOrder:0,triggerTotal:0,list:[],track(n){this.list.push(n)},trigger(n,i){if(this.triggerTotal++,this.list=this.list.map(g=>(g.name===n&&(g.visible=i),g)),this.triggerTotal>=this.list.length)if(this.currOrder<this.list.length){for(;this.currOrder<this.list.length&&(h[this.list[this.currOrder].name]=this.list[this.currOrder].visible,!this.list[this.currOrder].visible);)this.currOrder++;this.currOrder=0}else this.triggerTotal=0,this.trigger(n,i)}};if(e){d.list=[];for(let n in e){let i={name:n,order:Number(e[n])};d.track(i)}d.list.sort((n,i)=>n.order-i.order)}return function(n,i){return d.trigger(n,i),{currVisible:h,dep:d}}}const S=l.defineComponent({props:{visible:[Object,Boolean],name:String,mask:{type:Boolean,default:!0},maskClosable:{type:Boolean,default:!0},type:{type:String,default:""},modalClass:{type:String,default:"modal-vue3-wrap"},width:{type:[String,Number],default:500},offsetTop:{type:[String,Number],default:100},zIndex:{type:[String,Number],default:1e3},title:{type:String,default:"Title"},animation:{type:Boolean,default:!0},closable:{type:Boolean,default:!0},draggable:{type:[Boolean,Object],default:!1},cancelButton:{type:Object,default:()=>({text:"cancel",onclick:null,loading:!1})},okButton:{type:Object,default:()=>({text:"ok",onclick:null,loading:!1})}},setup(e,{slots:h,emit:d}){let n;const i=e.name,g=typeof e.width=="string"?e.width:`${e.width}px`,E=typeof e.offsetTop=="string"?e.offsetTop:`${e.offsetTop}px`,k=l.ref(null),p=l.ref(null);let w=null,v=null,r=l.reactive({init:.6,value:.6,max:1,step:.02,speed:6,linear:!1}),b=l.reactive({init:0,value:0,max:360,step:40,speed:40,linear:!0});const B=t=>{if(t.value>=t.max)return t.linear?t.value=t.init:t.value=t.max,!1;setTimeout(()=>{t.value+=t.step},t.speed)},x=t=>{t&&n.list.length>0?n.trigger(t,!1):d("update:visible",!1)},L=t=>{!e.maskClosable||!e.mask||t.target===k.value&&x(i)};let o=l.reactive({value:!1,target:""});const T=(t,c)=>{const f=t[c];(!f.loading||f.loading&&!o.value)&&(f.onclick&&typeof f.onclick=="function"?f.onclick():x(t.name),o.value=!0,o.target=c)},a=l.ref(),u=l.reactive({left:void 0,top:void 0}),y=t=>{t.preventDefault(),t.stopPropagation()},$=t=>{let c=p.value.offsetLeft,f=p.value.offsetTop,C={width:p.value.offsetWidth,height:p.value.offsetHeight,clientWidth:document.documentElement.clientWidth,clientHeight:document.documentElement.clientHeight,x:t.pageX-c,y:t.pageY-f};a.value=C,y(t);const O=m=>{if(!a.value)return;let N=m.pageX,z=m.pageY;u.left=Math.min(Math.max(N-a.value.x,0),a.value.clientWidth-a.value.width),u.top=Math.min(Math.max(z-a.value.y,0),a.value.clientHeight-a.value.height),y(m)},j=m=>{!a.value||(a.value=void 0,y(m),document.removeEventListener("pointermove",O),document.removeEventListener("pointerup",j))};document.addEventListener("pointermove",O),document.addEventListener("pointerup",j)};return l.watch(()=>e.draggable,t=>{typeof t=="object"&&t!==null&&t.addEventListener("pointerdown",$)}),()=>{if(h.default){let t;return typeof e.visible=="boolean"?t=e.visible:(t=e.visible.currVisible[i],n=e.visible.dep),t?(o.value&&B(b),e.animation===!1?r.value=r.max:(w!=i&&(w=i,r.value=r.init),B(r)),r.value>=r.max&&!a.value&&v!=i&&(v=i,d("onVisible"))):(v==i||!i)&&(r.value=r.init,v=null,o.value=!1,d("onUnVisible")),t?l.h("div",{class:e.modalClass},[e.mask?l.h("div",{class:"modal-vue3-mask",style:"width:100%;height:100%;position:fixed;left:0;top:0;background-color:rgba(0, 0, 0, 0.25)"}):null,l.h("div",{ref:k,style:`position:fixed;left:0;right:0;top:0;bottom:0;margin: 0 auto;z-index:${e.zIndex};overflow:auto;outline:0;`,onclick:c=>{L(c)}},[l.h("div",{ref:p,class:"modal-vue3-content",style:`width:${g};position:relative;top:${typeof u.top=="number"?u.top+"px":E};left:${u.left?u.left+"px":""};margin: ${typeof u.left=="number"?"0":"0 auto"}; ${e.type!="clean"?"border:1px solid #f0f0f0;":""}overflow:auto;outline:0;box-sizing:border-box; ${e.type!="clean"?"background-color:#fff;":""}border-radius:2px;transform:scale(${r.value});`},[e.type!="clean"?l.h("div",{class:"modal-vue3-header",style:`padding:12px 22px;border-bottom:1px solid #f0f0f0;position:relative;${e.draggable&&typeof e.draggable=="boolean"?"cursor:move;":""}`,onpointerdown:e.draggable&&typeof e.draggable=="boolean"?$:null},[l.h("div",null,e.title),e.closable?l.h("div",{style:"width:20px;height:16px;cursor:pointer;position:absolute;top:15px;right:15px;font-size: 20px;",onclick:()=>{x(i)}},[l.h("div",{style:"width:14px;height:1px;position:absolute;left:0;right:0;top:0;bottom:0;margin:auto;background-color:#999;transform:rotate(45deg);"},""),l.h("div",{style:"width:14px;height:1px;position:absolute;left:0;right:0;top:0;bottom:0;margin:auto;background-color:#999;transform:rotate(-45deg);"},"")]):null]):null,l.h("div",{class:"modal-vue3-body",style:e.type!="clean"?"padding: 14px 22px":""},h.default()),e.type!="clean"?l.h("div",{class:"modal-vue3-footer",style:"padding: 12px 22px;display:flex;justify-content:flex-end;align-items:center;border-top:1px solid #f0f0f0;"},[l.h("div",{class:"modal-vue3-footer-cancel",style:`margin-right: 20px;height:30px;padding:0 8px;border-radius:2px;border: 1px solid #d9d9d9;display:flex;justify-content:center;align-items:center;cursor:pointer;position:relative;${o.value&&o.target==="cancelButton"?"opacity:.6;":""}`,onclick:()=>{T(e,"cancelButton")}},[o.value&&o.target==="cancelButton"?l.h("span",{style:`width: 10px;height:10px;margin-right:5px;border:1px solid #666;border-radius:50%;border-top:1px solid transparent; transform:rotate(${b.value}deg);`}):null,l.h("div",{style:"min-width:44px;text-align:center;"},e.cancelButton.text||"cancel")]),l.h("div",{class:"modal-vue3-footer-ok",style:`height:30px;padding: 0 8px;border-radius:2px;display:flex;justify-content:center;align-items:center;background-color:#4395ff;color:#fff;cursor:pointer;position:relative;${o.value&&o.target==="okButton"?"opacity:.6;":""}`,onclick:()=>{T(e,"okButton")}},[o.value&&o.target==="okButton"?l.h("span",{style:`width: 10px;height:10px;margin-right:5px;border:1px solid #fff;border-radius:50%;border-top:1px solid transparent; transform:rotate(${b.value}deg);`}):null,l.h("div",{style:"min-width:44px;text-align:center;"},e.okButton.text||"ok")])]):null])])]):null}}}});s.Modal=S,s.useModal=M,Object.defineProperties(s,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
