(function(s,i){typeof exports=="object"&&typeof module<"u"?i(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],i):(s=typeof globalThis<"u"?globalThis:s||self,i(s["usemodal-vue3"]={},s.Vue))})(this,function(s,i){"use strict";function b(e){return typeof e=="boolean"}function w(e){return typeof e=="number"}function B(e){return typeof e=="object"&&e!==null}function z(e){const h=i.reactive({}),d={currOrder:0,triggerTotal:0,list:[],track(n){this.list.push(n)},trigger(n,l){if(this.triggerTotal++,this.list=this.list.map(g=>(g.name===n&&(g.visible=l),g)),this.triggerTotal>=this.list.length)if(this.currOrder<this.list.length){for(;this.currOrder<this.list.length&&(h[this.list[this.currOrder].name]=this.list[this.currOrder].visible,!this.list[this.currOrder].visible);)this.currOrder++;this.currOrder=0}else this.triggerTotal=0,this.trigger(n,l)}};if(e){d.list=[];for(let n in e){let l={name:n,order:Number(e[n])};d.track(l)}d.list.sort((n,l)=>n.order-l.order)}return function(n,l){return d.trigger(n,l),{currVisible:h,dep:d}}}const L=i.defineComponent({props:{visible:[Object,Boolean],name:String,mask:{type:Boolean,default:!0},maskClosable:{type:Boolean,default:!0},type:{type:String,default:""},modalClass:{type:String,default:"modal-vue3-wrap"},width:{type:[String,Number],default:500},offsetTop:{type:[String,Number],default:100},zIndex:{type:[String,Number],default:1e3},title:{type:String,default:"Title"},animation:{type:Boolean,default:!0},closable:{type:Boolean,default:!0},draggable:{type:[Boolean,Object],default:!1},cancelButton:{type:Object,default:()=>({text:"cancel",onclick:null,loading:!1})},okButton:{type:Object,default:()=>({text:"ok",onclick:null,loading:!1})}},setup(e,{slots:h,emit:d}){let n;const l=e.name,g=typeof e.width=="string"?e.width:`${e.width}px`,N=typeof e.offsetTop=="string"?e.offsetTop:`${e.offsetTop}px`,$=i.ref(null),p=i.ref(null);let T=null,v=null,r=i.reactive({init:.6,value:.6,max:1,step:.02,speed:6,linear:!1}),x=i.reactive({init:0,value:0,max:360,step:40,speed:40,linear:!0});const O=t=>{if(t.value>=t.max)return t.linear?t.value=t.init:t.value=t.max,!1;setTimeout(()=>{t.value+=t.step},t.speed)},y=t=>{t&&n.list.length>0&&B(e.visible)?n.trigger(t,!1):d("update:visible",!1)},C=t=>{!e.maskClosable||!e.mask||t.target===$.value&&y(l)};let o=i.reactive({value:!1,target:""});const j=(t,c)=>{const f=t[c];(!f.loading||f.loading&&!o.value)&&(f.onclick&&typeof f.onclick=="function"?f.onclick():y(t.name),o.value=!0,o.target=c)},a=i.ref(),u=i.reactive({left:void 0,top:void 0}),k=t=>{t.preventDefault(),t.stopPropagation()},M=t=>{let c=p.value.offsetLeft,f=p.value.offsetTop,V={width:p.value.offsetWidth,height:p.value.offsetHeight,clientWidth:document.documentElement.clientWidth,clientHeight:document.documentElement.clientHeight,x:t.pageX-c,y:t.pageY-f};a.value=V,k(t);const S=m=>{if(!a.value)return;let W=m.pageX,H=m.pageY;u.left=Math.min(Math.max(W-a.value.x,0),a.value.clientWidth-a.value.width),u.top=Math.min(Math.max(H-a.value.y,0),a.value.clientHeight-a.value.height),k(m)},E=m=>{!a.value||(a.value=void 0,k(m),document.removeEventListener("pointermove",S),document.removeEventListener("pointerup",E))};document.addEventListener("pointermove",S),document.addEventListener("pointerup",E)};return i.watch(()=>e.draggable,t=>{B(t)&&t.addEventListener("pointerdown",M)}),()=>{if(h.default){let t;return b(e.visible)?t=e.visible:(t=e.visible.currVisible[l],n=e.visible.dep),t?(o.value&&O(x),e.animation===!1?r.value=r.max:(T!=l&&(T=l,r.value=r.init),O(r)),r.value>=r.max&&!a.value&&v!=l&&(v=l,d("onVisible"))):(v==l||!l)&&(r.value=r.init,v=null,o.value=!1,d("onUnVisible")),t?i.h("div",{class:e.modalClass},[e.mask?i.h("div",{class:"modal-vue3-mask",style:`width:100%;height:100%;position:fixed;left:0;top:0;background-color:rgba(0, 0, 0, 0.25);z-index:${e.zIndex-1};`}):null,i.h("div",{ref:$,style:`position:fixed;left:0;right:0;top:0;bottom:0;margin: 0 auto;z-index:${e.zIndex};overflow:auto;outline:0;`,onclick:c=>{C(c)}},[i.h("div",{ref:p,class:"modal-vue3-content",style:`width:${g};position:relative;top:${w(u.top)?u.top+"px":N};left:${u.left?u.left+"px":""};margin: ${w(u.left)?"0":"0 auto"}; ${e.type!="clean"?"border:1px solid #f0f0f0;":""}overflow:auto;outline:0;box-sizing:border-box; ${e.type!="clean"?"background-color:#fff;":""}border-radius:2px;transform:scale(${r.value});`},[e.type!="clean"?i.h("div",{class:"modal-vue3-header",style:`padding:12px 22px;border-bottom:1px solid #f0f0f0;position:relative;${e.draggable&&b(e.draggable)?"cursor:move;":""}`,onpointerdown:e.draggable&&b(e.draggable)?M:null},[i.h("div",null,e.title),e.closable?i.h("div",{style:"width:20px;height:16px;cursor:pointer;position:absolute;top:15px;right:15px;font-size: 20px;",onclick:()=>{y(l)}},[i.h("div",{style:"width:14px;height:1px;position:absolute;left:0;right:0;top:0;bottom:0;margin:auto;background-color:#999;transform:rotate(45deg);"},""),i.h("div",{style:"width:14px;height:1px;position:absolute;left:0;right:0;top:0;bottom:0;margin:auto;background-color:#999;transform:rotate(-45deg);"},"")]):null]):null,i.h("div",{class:"modal-vue3-body",style:e.type!="clean"?"padding: 14px 22px":""},h.default()),e.type!="clean"?i.h("div",{class:"modal-vue3-footer",style:"padding: 12px 22px;display:flex;justify-content:flex-end;align-items:center;border-top:1px solid #f0f0f0;"},[i.h("div",{class:"modal-vue3-footer-cancel",style:`margin-right: 20px;height:30px;padding:0 8px;border-radius:2px;border: 1px solid #d9d9d9;display:flex;justify-content:center;align-items:center;cursor:pointer;position:relative;${o.value&&o.target==="cancelButton"?"opacity:.6;":""}`,onclick:()=>{j(e,"cancelButton")}},[o.value&&o.target==="cancelButton"?i.h("span",{style:`width: 10px;height:10px;margin-right:5px;border:1px solid #666;border-radius:50%;border-top:1px solid transparent; transform:rotate(${x.value}deg);`}):null,i.h("div",{style:"min-width:44px;text-align:center;"},e.cancelButton.text||"cancel")]),i.h("div",{class:"modal-vue3-footer-ok",style:`height:30px;padding: 0 8px;border-radius:2px;display:flex;justify-content:center;align-items:center;background-color:#4395ff;color:#fff;cursor:pointer;position:relative;${o.value&&o.target==="okButton"?"opacity:.6;":""}`,onclick:()=>{j(e,"okButton")}},[o.value&&o.target==="okButton"?i.h("span",{style:`width: 10px;height:10px;margin-right:5px;border:1px solid #fff;border-radius:50%;border-top:1px solid transparent; transform:rotate(${x.value}deg);`}):null,i.h("div",{style:"min-width:44px;text-align:center;"},e.okButton.text||"ok")])]):null])])]):null}}}});s.Modal=L,s.useModal=z,Object.defineProperties(s,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
