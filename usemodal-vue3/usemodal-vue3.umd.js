(function(r,t){typeof exports=="object"&&typeof module<"u"?t(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],t):(r=typeof globalThis<"u"?globalThis:r||self,t(r["usemodal-vue3"]={},r.Vue))})(this,function(r,t){"use strict";const p=t.reactive({}),u={currOrder:0,triggerTotal:0,list:[],track(e){this.list.push(e)},trigger(e,n){if(this.triggerTotal++,this.list=this.list.map(i=>(i.name===e&&(i.visible=n),i)),this.triggerTotal>=this.list.length)if(this.currOrder<this.list.length){for(;this.currOrder<this.list.length&&(p[this.list[this.currOrder].name]=this.list[this.currOrder].visible,!this.list[this.currOrder].visible);)this.currOrder++;this.currOrder=0}else this.triggerTotal=0,this.trigger(e,n)}};function B(e){if(e){u.list=[];for(let n in e){let i={name:n,order:Number(e[n])};u.track(i)}u.list.sort((n,i)=>n.order-i.order)}return function(n,i){return u.trigger(n,i),p}}const T=t.defineComponent({props:{visible:[Object,Boolean],name:String,mask:{type:Boolean,default:!0},maskClosable:{type:Boolean,default:!0},type:{type:String,default:""},modalClass:{type:String,default:"modal-vue3-wrap"},width:{type:[String,Number],default:500},offsetTop:{type:[String,Number],default:100},zIndex:{type:[String,Number],default:1e3},title:{type:String,default:"Title"},animation:{type:Boolean,default:!0},closable:{type:Boolean,default:!0},draggable:{type:[Boolean,Object],default:!1},cancelButton:{type:Object,default:()=>({text:"cancel",onclick:null})},okButton:{type:Object,default:()=>({text:"ok",onclick:null})}},setup(e,{slots:n,emit:i}){const o=e.name,O=typeof e.width=="string"?e.width:`${e.width}px`,S=typeof e.offsetTop=="string"?e.offsetTop:`${e.offsetTop}px`,v=t.ref(null),f=t.ref(null);let x=null,g=null,s=t.ref(.6);const E=l=>{let c=null;if(l.value>=1)return!1;clearTimeout(c),c=setTimeout(()=>{l.value+=.02},6)},m=l=>{l&&u.list.length>0?u.trigger(l,!1):i("update:visible",!1)},$=l=>{!e.maskClosable||!e.mask||l.target===v.value&&m(o)},a=t.ref(),d=t.reactive({left:void 0,top:void 0}),b=l=>{l.preventDefault(),l.stopPropagation()},y=l=>{let c=f.value.offsetLeft,j=f.value.offsetTop,C={width:f.value.offsetWidth,height:f.value.offsetHeight,clientWidth:document.documentElement.clientWidth,clientHeight:document.documentElement.clientHeight,x:l.pageX-c,y:l.pageY-j};a.value=C,b(l);const k=h=>{if(!a.value)return;let L=h.pageX,M=h.pageY;d.left=Math.min(Math.max(L-a.value.x,0),a.value.clientWidth-a.value.width),d.top=Math.min(Math.max(M-a.value.y,0),a.value.clientHeight-a.value.height),b(h)},w=h=>{!a.value||(a.value=void 0,b(h),document.removeEventListener("pointermove",k),document.removeEventListener("pointerup",w))};document.addEventListener("pointermove",k),document.addEventListener("pointerup",w)};return t.watch(()=>e.draggable,l=>{typeof l=="object"&&l!==null&&l.addEventListener("pointerdown",y)}),()=>{if(n.default){let l=o?e.visible[o]:e.visible;return l?(e.animation===!1?s.value=1:(x!=o&&(x=o,s.value=.6),E(s)),s.value>=1&&!a.value&&g!=o&&(g=o,i("onVisible"))):(g==o||!o)&&(s.value=.6,g=null,i("onUnVisible")),l?t.h("div",{class:e.modalClass},[e.mask?t.h("div",{class:"modal-vue3-mask",style:"width:100%;height:100%;position:fixed;left:0;top:0;background-color:rgba(0, 0, 0, 0.25)"}):null,t.h("div",{ref:v,style:`position:fixed;left:0;right:0;top:0;bottom:0;margin: 0 auto;z-index:${e.zIndex};overflow:auto;outline:0;`,onclick:c=>{$(c)}},[t.h("div",{ref:f,class:"modal-vue3-content",style:`width:${O};position:relative;top:${typeof d.top=="number"?d.top+"px":S};left:${d.left?d.left+"px":""};margin: ${typeof d.left=="number"?"0":"0 auto"}; ${e.type!="clean"?"border:1px solid #f0f0f0;":""}overflow:auto;outline:0;box-sizing:border-box; ${e.type!="clean"?"background-color:#fff;":""}border-radius:2px;transform:scale(${s.value});`},[e.type!="clean"?t.h("div",{class:"modal-vue3-header",style:`padding:12px 22px;border-bottom:1px solid #f0f0f0;position:relative;${e.draggable&&typeof e.draggable=="boolean"?"cursor:move;":""}`,onpointerdown:e.draggable&&typeof e.draggable=="boolean"?y:null},[t.h("div",null,e.title),e.closable?t.h("div",{style:"width:20px;height:16px;cursor:pointer;position:absolute;top:15px;right:15px;font-size: 20px;",onclick:()=>{m(o)}},[t.h("div",{style:"width:14px;height:1px;position:absolute;left:0;right:0;top:0;bottom:0;margin:auto;background-color:#999;transform:rotate(45deg);"},""),t.h("div",{style:"width:14px;height:1px;position:absolute;left:0;right:0;top:0;bottom:0;margin:auto;background-color:#999;transform:rotate(-45deg);"},"")]):null]):null,t.h("div",{class:"modal-vue3-body",style:e.type!="clean"?"padding: 14px 22px":""},n.default()),e.type!="clean"?t.h("div",{class:"modal-vue3-footer",style:"padding: 12px 22px;display:flex;justify-content:flex-end;align-items:center;border-top:1px solid #f0f0f0;"},[t.h("div",{class:"modal-vue3-footer-cancel",style:"margin-right: 20px;width:60px;height:30px;border-radius:2px;border: 1px solid #d9d9d9;display:flex;justify-content:center;align-items:center;cursor:pointer;",onclick:e.cancelButton.onclick&&typeof e.cancelButton.onclick=="function"?e.cancelButton.onclick:()=>{m(o)}},e.cancelButton.text||"cancel"),t.h("div",{class:"modal-vue3-footer-ok",style:"width:60px;height:30px;border-radius:2px;display:flex;justify-content:center;align-items:center;background-color:#4395ff;color:#fff;cursor:pointer;",onclick:e.okButton.onclick&&typeof e.okButton.onclick=="function"?e.okButton.onclick:()=>{m(o)}},e.okButton.text||"ok")]):null])])]):null}}}});r.Modal=T,r.useModal=B,Object.defineProperties(r,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
